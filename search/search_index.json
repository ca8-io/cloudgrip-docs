{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Welcome to CloudGrip Docs","text":""},{"location":"#build-your-business-with-a-first-class-cloud-management-platform-solution","title":"Build your business with a first class Cloud Management Platform solution","text":"<p>CloudGrip is a cloud management platform that allows you to simplify and centrally manage your Azure Cloud. It\u2019s a Infrastructure as Code (IaC) framework in which you can fully define your Azure environment. Based on your preferred deployment tooling you can deploy resources to your Azure environment which is also maintained in code.</p> <ul> <li> CloudGrip is modular in its sense that it allows you to choose which features you want to utilize in the framework. You could go for only a setup that describes your Azure environment and automate deployments or you could add modules like RBAC-, Policy-, Costs management so you can extend your IaC config to match your complete Azure Environment.</li> <li> CloudGrip allows your organization or partners to write extensions for the framework. In that way organizations could even extend functionality to the framework to support single source of truth with regards to the Azure Cloud configuration. In the extension package you supply the parameters and properties and supporting pipelines. All within a single framework and codebase.</li> </ul>"},{"location":"about/","title":"About","text":""},{"location":"about/#cloud-autom8","title":"Cloud Autom8","text":"<p>CloudGrip is developed and maintained by Cloud Autom8</p>"},{"location":"about/#support","title":"Support","text":"<p>Support can be reached at support at ca8 dot io.</p>"},{"location":"configuration/deployments/","title":"CloudGrip Configuration Guide: Deployments &amp; RBAC","text":""},{"location":"configuration/deployments/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Overview</li> <li>Understanding CloudGrip Architecture</li> <li>Configuration Levels</li> <li>Deployment Configuration</li> <li>Deployment Properties Reference</li> <li>RBAC Configuration</li> <li>RBAC Properties Reference</li> <li>Best Practices</li> <li>Pipeline Integration</li> </ul>"},{"location":"configuration/deployments/#overview","title":"Overview","text":"<p>CloudGrip is a hierarchical infrastructure-as-code platform that manages Azure resources at three levels: Tenant, Management Group, and Subscription. It uses JSON configuration files with defined schemas to declare infrastructure state, RBAC assignments, and deployment specifications.</p> <p>The platform supports multiple deployment technologies:</p> <ul> <li>Bicep templates</li> <li>ARM (Azure Resource Manager) templates  </li> <li>Terraform configurations</li> </ul>"},{"location":"configuration/deployments/#understanding-cloudgrip-architecture","title":"Understanding CloudGrip Architecture","text":"<p>CloudGrip follows a hierarchical, declarative configuration model based on Azure's management structure:</p> <pre><code>Tenant (Root)\n\u251c\u2500\u2500 Root Management Group\n\u2502   \u251c\u2500\u2500 RBAC Assignments\n\u2502   \u251c\u2500\u2500 Policy Assignments\n\u2502   \u2514\u2500\u2500 Subscriptions\n\u2514\u2500\u2500 Child Management Groups\n    \u251c\u2500\u2500 RBAC Assignments\n    \u251c\u2500\u2500 Policy Assignments\n    \u251c\u2500\u2500 Subscriptions\n    \u2502   \u251c\u2500\u2500 Deployments (Bicep/ARM/Terraform)\n    \u2502   \u2514\u2500\u2500 RBAC Assignments\n    \u2514\u2500\u2500 Child Management Groups\n</code></pre>"},{"location":"configuration/deployments/#key-concepts","title":"Key Concepts","text":"<ol> <li>Hierarchical Structure: Mirrors Azure's tenant \u2192 management group \u2192 subscription hierarchy</li> <li>Schema-Driven: All configurations validated against JSON schemas</li> <li>Declarative State: Define desired state; pipelines handle execution</li> <li>Deployment Versioning: <code>deploymentGuid</code> controls when redeployments occur</li> <li>Automated Pipelines: CI/CD pipelines detect changes and execute deployments</li> <li>Multi-Technology Support: Use Bicep, ARM, or Terraform within the same platform</li> </ol>"},{"location":"configuration/deployments/#configuration-levels","title":"Configuration Levels","text":""},{"location":"configuration/deployments/#tenant-level-tenantjson","title":"Tenant Level (<code>tenant.json</code>)","text":"<p>The tenant configuration defines the root-level Azure tenant settings.</p> <p>Schema: <code>http://schema.ca8.io/schemas/2024-01-01/tenant.json</code></p> <p>Key Properties:</p> <ul> <li><code>tenantName</code>: Human-readable tenant name</li> <li><code>tenantId</code>: Azure AD tenant GUID</li> <li><code>primaryDomain</code>: Primary domain (e.g., <code>company.onmicrosoft.com</code>)</li> <li><code>rootManagementGroup</code>: Root management group configuration</li> <li><code>managementGroups</code>: Array of child management groups</li> <li><code>marketPlaceFeatures</code>: Marketplace offerings to enable</li> </ul>"},{"location":"configuration/deployments/#management-group-level-managementgroupjson","title":"Management Group Level (<code>managementgroup.json</code>)","text":"<p>Management groups provide organizational structure and inheritance of policies and RBAC.</p> <p>Schema: <code>http://schema.ca8.io/schemas/2024-01-01/managementgroup.json</code></p> <p>Key Properties:</p> <ul> <li><code>tenantId</code>: Parent tenant GUID</li> <li><code>parentManagementGroupId</code>: Parent management group ID</li> <li><code>managementGroupId</code>: This management group's unique ID</li> <li><code>managementGroupName</code>: Display name</li> <li><code>managementGroups</code>: Child management groups</li> <li><code>subscriptions</code>: Subscriptions under this management group</li> <li><code>policy</code>: Policy and initiative assignments</li> <li><code>rbac</code>: RBAC role assignments at MG scope</li> </ul>"},{"location":"configuration/deployments/#subscription-level-subscriptionjson","title":"Subscription Level (<code>subscription.json</code>)","text":"<p>Subscriptions contain the actual resource deployments and detailed configurations.</p> <p>Schema: <code>http://schema.ca8.io/schemas/2024-01-01/subscription.json</code></p> <p>Key Properties:</p> <ul> <li><code>subscriptionId</code>: Azure subscription GUID</li> <li><code>subscriptionName</code>: Display name</li> <li><code>location</code>: Default Azure region</li> <li><code>deployments</code>: Array of deployment objects (main focus)</li> <li><code>rbac</code>: RBAC assignments at subscription scope</li> <li><code>tags</code>: Subscription-level tags</li> <li><code>centralConfig</code>: Shared infrastructure references (VNet, Log Analytics, etc.)</li> </ul>"},{"location":"configuration/deployments/#deployment-configuration","title":"Deployment Configuration","text":"<p>Deployments are defined in the <code>deployments</code> array within a subscription configuration file.</p>"},{"location":"configuration/deployments/#deployment-object-structure","title":"Deployment Object Structure","text":"<pre><code>{\n  \"name\": \"deployment-name\",\n  \"type\": \"bicep|arm|terraform\",\n  \"templateFilePath\": \"path/to/template.bicep\",\n  \"templateParameterFilePath\": \"path/to/parameters.bicepparam\",\n  \"deploymentGuid\": \"803de292\",\n  \"resourceGroupName\": \"rg-resource-group\",\n  \"preScriptPath\": \"scripts/pre-deploy.ps1\",\n  \"postScriptPath\": \"scripts/post-deploy.ps1\"\n}\n</code></pre>"},{"location":"configuration/deployments/#complete-example","title":"Complete Example","text":"<pre><code>{\n  \"deployments\": [\n    {\n      \"name\": \"storage\",\n      \"type\": \"bicep\",\n      \"templateFilePath\": \"main.bicep\",\n      \"templateParameterFilePath\": \"main.prod.bicepparam\",\n      \"deploymentGuid\": \"a1b2c3d4\",\n      \"resourceGroupName\": \"rg-storage-prod\",\n      \"preScriptPath\": \"pre-deploy.ps1\",\n      \"postScriptPath\": \"post-deploy.ps1\"\n    },\n    {\n      \"name\": \"network\",\n      \"type\": \"arm\",\n      \"templateFilePath\": \"vnet.json\",\n      \"templateParameterFilePath\": \"vnet.parameters.json\",\n      \"deploymentGuid\": \"5e6f7g8h\",\n      \"resourceGroupName\": \"rg-network-prod\"\n    },\n    {\n      \"name\": \"monitoring\",\n      \"type\": \"terraform\",\n      \"deploymentGuid\": \"9i0j1k2l\",\n      \"resourceGroupName\": \"rg-monitoring\"\n    }\n  ]\n}\n</code></pre>"},{"location":"configuration/deployments/#deployment-properties-reference","title":"Deployment Properties Reference","text":""},{"location":"configuration/deployments/#name-required","title":"<code>name</code> (required)","text":"<ul> <li>Type: String</li> <li>Description: Unique identifier for this deployment</li> <li>Example: <code>\"devopsagents\"</code>, <code>\"storage-infrastructure\"</code></li> <li>Constraints: Must be unique within the subscription configuration</li> </ul>"},{"location":"configuration/deployments/#type-required","title":"<code>type</code> (required)","text":"<ul> <li>Type: String (enum)</li> <li>Description: Deployment technology to use</li> <li>Valid Values:</li> <li><code>\"bicep\"</code> - Bicep template deployment</li> <li><code>\"arm\"</code> - ARM JSON template deployment</li> <li><code>\"terraform\"</code> - Terraform configuration</li> <li>Example: <code>\"bicep\"</code></li> <li>Pattern: <code>^(bicep|arm|terraform)$</code></li> </ul>"},{"location":"configuration/deployments/#templatefilepath-required-for-biceparm","title":"<code>templateFilePath</code> (required for bicep/arm)","text":"<ul> <li>Type: String</li> <li>Description: Path to the template file relative to repository root</li> <li>Required When: <code>type</code> is <code>\"bicep\"</code> or <code>\"arm\"</code></li> <li>Not Required When: <code>type</code> is <code>\"terraform\"</code></li> <li>Examples:</li> <li><code>\"main.bicep\"</code></li> <li><code>\"templates/storage.json\"</code></li> <li><code>\"infrastructure/network/vnet.bicep\"</code></li> </ul>"},{"location":"configuration/deployments/#templateparameterfilepath-optional","title":"<code>templateParameterFilePath</code> (optional)","text":"<ul> <li>Type: String</li> <li>Description: Path to parameter file for the template</li> <li>Examples:</li> <li><code>\"main.dev.bicepparam\"</code> (Bicep parameters)</li> <li><code>\"storage.parameters.json\"</code> (ARM parameters)</li> <li>Note: If omitted, template must have default values or use inline parameters</li> </ul>"},{"location":"configuration/deployments/#deploymentguid-required","title":"<code>deploymentGuid</code> (required)","text":"<ul> <li>Type: String (8-character hex)</li> <li>Description: Version control identifier - changing this triggers redeployment</li> <li>Format: 8 lowercase hexadecimal characters</li> <li>Pattern: <code>^([a-f0-9]{8})$</code></li> <li>Examples: <code>\"803de292\"</code>, <code>\"a1b2c3d4\"</code>, <code>\"5e6f7g8h\"</code></li> </ul> <p>Critical Behavior:</p> <ul> <li>This is the deployment version fingerprint</li> <li>Pipeline compares current <code>deploymentGuid</code> with last deployed value</li> <li>Same GUID \u2192 Configuration unchanged \u2192 No deployment</li> <li>Different GUID \u2192 New version \u2192 Deployment executes</li> <li>This prevents unnecessary redeployments and gives explicit control</li> </ul> <p>How to Use:</p> <ol> <li>Initial deployment: Set any 8-char hex value (e.g., <code>\"00000001\"</code>)</li> <li>Make template/parameter changes</li> <li>To deploy changes: Change the GUID (e.g., <code>\"00000002\"</code>)</li> <li>Commit and push</li> <li>Pipeline detects GUID change and deploys</li> </ol> <p>Example Workflow:</p> <pre><code>Initial State:\n\"deploymentGuid\": \"803de292\"\n\u2192 Deploy storage account\n\nUpdate template, don't deploy yet\n\"deploymentGuid\": \"803de292\"  // SAME - no deployment\n\u2192 Pipeline skips deployment\n\nChange GUID to deploy update:\n\"deploymentGuid\": \"804de292\"  // CHANGED\n\u2192 Pipeline deploys updated template\n</code></pre>"},{"location":"configuration/deployments/#resourcegroupname-optional","title":"<code>resourceGroupName</code> (optional)","text":"<ul> <li>Type: String</li> <li>Description: Target resource group for deployment</li> <li>Example: <code>\"rg-devopsagents\"</code>, <code>\"rg-storage-prod\"</code></li> <li>Note: If resource group doesn't exist, deployment may create it or fail depending on template</li> </ul>"},{"location":"configuration/deployments/#prescriptpath-optional","title":"<code>preScriptPath</code> (optional)","text":"<ul> <li>Type: String</li> <li>Description: PowerShell script to run before deployment</li> <li>Example: <code>\"pre.ps1\"</code>, <code>\"scripts/pre-deploy.ps1\"</code></li> <li>Use Cases:</li> <li>Environment validation</li> <li>Prerequisite resource checks</li> <li>Configuration preparation</li> <li>Secret retrieval from Key Vault</li> </ul>"},{"location":"configuration/deployments/#postscriptpath-optional","title":"<code>postScriptPath</code> (optional)","text":"<ul> <li>Type: String</li> <li>Description: PowerShell script to run after successful deployment</li> <li>Example: <code>\"post.ps1\"</code>, <code>\"scripts/configure-app.ps1\"</code></li> <li>Use Cases:</li> <li>Post-deployment configuration</li> <li>Application setup</li> <li>Integration tests</li> <li>Notification sending</li> </ul>"},{"location":"configuration/deployments/#rbac-configuration","title":"RBAC Configuration","text":"<p>RBAC (Role-Based Access Control) can be configured at three levels in CloudGrip:</p> <ol> <li>Tenant Root Management Group - Inherited by all child resources</li> <li>Management Group Level - Inherited by subscriptions and child MGs</li> <li>Subscription Level - Applies to subscription and its resource groups</li> </ol>"},{"location":"configuration/deployments/#rbac-object-structure","title":"RBAC Object Structure","text":"<pre><code>{\n  \"name\": \"Contributor\",\n  \"assignedUsers\": [\n    \"user@example.com\"\n  ],\n  \"assignedGroups\": [\n    \"DevOps Team\",\n    \"ENGINEERING/CLOUD-PLATFORM\"\n  ],\n  \"assignedSpnObjectIds\": [\n    \"a1b2c3d4-e5f6-7890-abcd-ef1234567890\"\n  ]\n}\n</code></pre>"},{"location":"configuration/deployments/#complete-examples","title":"Complete Examples","text":""},{"location":"configuration/deployments/#subscription-level-rbac","title":"Subscription-Level RBAC","text":"<pre><code>{\n  \"rbac\": [\n    {\n      \"name\": \"Owner\",\n      \"assignedUsers\": [\n        \"admin@company.com\"\n      ],\n      \"assignedGroups\": [\n        \"Platform Admins\"\n      ],\n      \"assignedSpnObjectIds\": []\n    },\n    {\n      \"name\": \"Contributor\",\n      \"assignedUsers\": [],\n      \"assignedGroups\": [\n        \"DevOps Engineers\",\n        \"ENGINEERING/DEVELOPERS\"\n      ],\n      \"assignedSpnObjectIds\": [\n        \"12345678-1234-1234-1234-123456789012\"\n      ]\n    },\n    {\n      \"name\": \"Reader\",\n      \"assignedUsers\": [\n        \"auditor@company.com\"\n      ],\n      \"assignedGroups\": [\n        \"Security Team\"\n      ],\n      \"assignedSpnObjectIds\": []\n    }\n  ]\n}\n</code></pre>"},{"location":"configuration/deployments/#management-group-rbac-with-inheritance","title":"Management Group RBAC with Inheritance","text":"<pre><code>{\n  \"managementGroupId\": \"mg-production\",\n  \"rbac\": [\n    {\n      \"name\": \"Security Admin\",\n      \"assignedUsers\": [],\n      \"assignedGroups\": [\n        \"Security Operations Center\"\n      ],\n      \"assignedSpnObjectIds\": []\n    }\n  ]\n}\n</code></pre>"},{"location":"configuration/deployments/#rbac-properties-reference","title":"RBAC Properties Reference","text":""},{"location":"configuration/deployments/#name-required_1","title":"<code>name</code> (required)","text":"<ul> <li>Type: String</li> <li>Description: Azure built-in or custom role name</li> <li>Common Built-in Roles:</li> <li><code>\"Owner\"</code> - Full access including access management</li> <li><code>\"Contributor\"</code> - Manage resources, cannot grant access</li> <li><code>\"Reader\"</code> - View resources only</li> <li><code>\"User Access Administrator\"</code> - Manage user access only</li> <li>Resource-specific roles (e.g., <code>\"Storage Blob Data Contributor\"</code>)</li> <li>Example: <code>\"Contributor\"</code></li> </ul>"},{"location":"configuration/deployments/#assignedusers-required","title":"<code>assignedUsers</code> (required)","text":"<ul> <li>Type: Array of strings (email addresses)</li> <li>Description: Email addresses of Azure AD users to assign this role</li> <li>Format: Valid email addresses</li> <li>Example: <code>[\"user@example.com\", \"admin@company.com\"]</code></li> <li>Note: Can be empty array <code>[]</code> if using only groups/service principals</li> </ul>"},{"location":"configuration/deployments/#assignedgroups-required","title":"<code>assignedGroups</code> (required)","text":"<ul> <li>Type: Array of strings</li> <li>Description: Names of Azure AD groups to assign this role</li> <li>Examples:</li> <li><code>[\"DevOps Team\"]</code></li> <li><code>[\"ENGINEERING/PLATFORM\", \"BU-CLOUDTEAM\"]</code></li> <li>Note: Group names are case-sensitive; can be empty array <code>[]</code></li> </ul>"},{"location":"configuration/deployments/#assignedspnobjectids-required","title":"<code>assignedSpnObjectIds</code> (required)","text":"<ul> <li>Type: Array of strings (GUIDs)</li> <li>Description: Object IDs of service principals (managed identities, app registrations)</li> <li>Format: Valid UUID/GUID format</li> <li>Pattern: <code>^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$</code></li> <li>Example: <code>[\"a1b2c3d4-e5f6-7890-abcd-ef1234567890\"]</code></li> <li>Note: Can be empty array <code>[]</code>; find in Azure Portal \u2192 Enterprise Applications \u2192 Object ID</li> </ul>"},{"location":"configuration/deployments/#scope-and-inheritance","title":"Scope and Inheritance","text":"<p>RBAC assignments automatically inherit down the hierarchy:</p> <pre><code>Root Management Group (Owner: Platform Admins)\n\u251c\u2500\u2500 Management Group: Production (Contributor: DevOps Team)\n\u2502   \u251c\u2500\u2500 Subscription: Prod-East (Reader: Auditors)\n\u2502   \u2502   \u2514\u2500\u2500 Resource Group: rg-app\n\u2502   \u2502       \u2514\u2500\u2500 Storage Account\n\u2502   \u2502           \u2193\n\u2502   \u2502       Effective Permissions:\n\u2502   \u2502       - Platform Admins: Owner (inherited from root)\n\u2502   \u2502       - DevOps Team: Contributor (inherited from MG)\n\u2502   \u2502       - Auditors: Reader (from subscription)\n</code></pre>"},{"location":"configuration/deployments/#best-practices","title":"Best Practices","text":""},{"location":"configuration/deployments/#deployment-configuration-best-practices","title":"Deployment Configuration Best Practices","text":"<ol> <li>Semantic Deployment Names</li> </ol> <pre><code>// Good - descriptive, scoped\n\"name\": \"prod-eastus-storage-accounts\"\n\n// Bad - vague\n\"name\": \"deployment1\"\n</code></pre> <ol> <li>Deployment GUID Management</li> <li>Use sequential or timestamped hex values for traceability</li> <li>Document GUID changes in commit messages</li> <li>Example pattern: <code>YYYYMMDD</code> in hex: <code>\"20240315\"</code> \u2192 <code>\"013c9f43\"</code></li> </ol> <pre><code># Generate timestamp-based GUID\necho \"obase=16; $(date +%Y%m%d)\" | bc | tr '[:upper:]' '[:lower:]'\n\n# Use first part of GUID\n((New-Guid) -replace '-').SubString(0, 8) | clip\n</code></pre> <ol> <li>Organize by Environment and Function</li> </ol> <pre><code>lz-name-app-x/\n\u251c\u2500\u2500 networking/\n\u2502   \u251c\u2500\u2500 main.bicep\n\u2502   \u251c\u2500\u2500 main.dev.bicepparam\n\u2502   \u2514\u2500\u2500 main.prod.bicepparam\n\u251c\u2500\u2500 storage/\n\u2502   \u2514\u2500\u2500 ...\n\u2514\u2500\u2500 compute/\n    \u2514\u2500\u2500 ...\n</code></pre> <ol> <li>Parameter File Naming Convention</li> <li><code>main.{environment}.bicepparam</code> for Bicep</li> <li><code>template.{environment}.parameters.json</code> for ARM</li> <li> <p>Examples: <code>main.dev.bicepparam</code>, <code>storage.prod.parameters.json</code></p> </li> <li> <p>Use Pre/Post Scripts Wisely</p> </li> <li>Keep scripts idempotent</li> <li>Log all actions</li> <li>Handle errors gracefully</li> <li> <p>Test scripts independently</p> </li> <li> <p>Template Type Selection</p> </li> <li>Bicep: Modern, concise, type-safe (recommended for new deployments)</li> <li>ARM: Mature, widely supported, verbose</li> <li>Terraform: Multi-cloud, state management</li> </ol>"},{"location":"configuration/deployments/#rbac-configuration-best-practices","title":"RBAC Configuration Best Practices","text":"<ol> <li>Principle of Least Privilege</li> </ol> <pre><code>// Prefer specific roles\n{\n  \"name\": \"Storage Blob Data Reader\",  // Specific\n  \"assignedGroups\": [\"App Service Team\"]\n}\n\n// Avoid overly broad access\n{\n  \"name\": \"Owner\",  // Too broad - use sparingly\n  \"assignedGroups\": [\"Everyone\"]\n}\n</code></pre> <ol> <li>Prefer Groups Over Individual Users</li> </ol> <pre><code>// Good - use groups\n{\n  \"name\": \"Contributor\",\n  \"assignedUsers\": [],\n  \"assignedGroups\": [\"Platform Engineering\"],\n  \"assignedSpnObjectIds\": []\n}\n\n// Bad - individual users (harder to maintain)\n{\n  \"name\": \"Contributor\",\n  \"assignedUsers\": [\"user1@company.com\", \"user2@company.com\", ...],\n  \"assignedGroups\": [],\n  \"assignedSpnObjectIds\": []\n}\n</code></pre> <ol> <li>Document Role Assignments</li> <li>Use clear group names</li> <li>Maintain group membership documentation</li> <li> <p>Regular access reviews</p> </li> <li> <p>Service Principal Management</p> </li> <li>Use managed identities when possible</li> <li>Document SPN purpose</li> <li> <p>Rotate credentials regularly</p> </li> <li> <p>Hierarchical Assignment Strategy</p> </li> <li>Assign broad roles at management group level</li> <li>Specific roles at subscription/resource group level</li> <li>Review inheritance impacts</li> </ol>"},{"location":"configuration/deployments/#security-best-practices","title":"Security Best Practices","text":"<ol> <li>Secret Management</li> <li>Never commit secrets to configuration files</li> <li>Use Azure Key Vault references in templates</li> <li> <p>Leverage Key Vault integration in Bicep/ARM</p> </li> <li> <p>Template Validation</p> </li> <li>Use schema validation before committing</li> <li>Run what-if analysis for ARM/Bicep</li> <li> <p>Test in non-production first</p> </li> <li> <p>Change Control</p> </li> <li>Require pull request reviews</li> <li>Mandate GUID changes for production deployments</li> <li>Use branch protection rules</li> </ol>"},{"location":"configuration/deployments/#pipeline-integration","title":"Pipeline Integration","text":"<p>CloudGrip deployments are executed through automated CI/CD pipelines that monitor configuration changes.</p>"},{"location":"configuration/deployments/#how-pipeline-deployment-works","title":"How Pipeline Deployment Works","text":"<ol> <li>Configuration Change: Developer modifies subscription JSON config</li> <li>Git Commit: Changes committed and pushed to repository</li> <li>Pipeline Trigger: Git push triggers CloudGrip deployment pipeline</li> <li>Configuration Parsing: Pipeline loads and validates JSON against schema</li> <li>Deployment Detection: For each deployment in <code>deployments</code> array:</li> <li>Compare <code>deploymentGuid</code> with last deployed GUID (stored in state)</li> <li>If GUID unchanged: Skip deployment, log \"No version change\"</li> <li>If GUID changed: Queue deployment for execution</li> <li>RBAC Processing: RBAC changes always processed (no GUID check)</li> <li>Deployment Execution:</li> <li>Run <code>preScriptPath</code> if specified</li> <li>Execute deployment based on <code>type</code>:<ul> <li>Bicep: <code>az deployment group create --template-file ... --parameters ...</code></li> <li>ARM: <code>az deployment group create --template-file ...</code></li> <li>Terraform: <code>terraform plan &amp;&amp; terraform apply</code></li> </ul> </li> <li>Run <code>postScriptPath</code> if specified</li> <li>State Update: Record deployed <code>deploymentGuid</code> in state storage</li> <li>Validation: Post-deployment health checks and validation</li> </ol>"},{"location":"configuration/deployments/#pipeline-workflow-diagram","title":"Pipeline Workflow Diagram","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Developer Edits   \u2502\n\u2502  subscription.json  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n           \u2502\n           \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Git Commit/Push   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n           \u2502\n           \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Pipeline Triggered \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n           \u2502\n           \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Validate Schema    \u2502\n\u2502  Load Config JSON   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n           \u2502\n           \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  For Each Deployment:              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502 Compare deploymentGuid      \u2502   \u2502\n\u2502  \u2502 with Last Deployed GUID     \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502             \u2502                      \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510             \u2502\n\u2502    \u2502                 \u2502             \u2502\n\u2502    \u25bc                 \u25bc             \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502\n\u2502 \u2502Same \u2502         \u2502Changed \u2502         \u2502\n\u2502 \u2502GUID \u2502         \u2502  GUID  \u2502         \u2502\n\u2502 \u2514\u2500\u2500\u252c\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502    \u2502                \u2502              \u2502\n\u2502    \u25bc                \u25bc              \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u2502\n\u2502 \u2502Skip \u2502      \u2502Queue Deploy  \u2502      \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2502\n\u2502                     \u2502              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                      \u2502\n                      \u25bc\n            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n            \u2502  Execute Queued  \u2502\n            \u2502   Deployments    \u2502\n            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                     \u2502\n          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n          \u2502                     \u2502\n          \u25bc                     \u25bc\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502  Pre-    \u2502         \u2502   RBAC   \u2502\n    \u2502 Script   \u2502         \u2502  Updates \u2502\n    \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502   Deploy     \u2502\n    \u2502   Template   \u2502\n    \u2502 (Bicep/ARM/  \u2502\n    \u2502  Terraform)  \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2502\n          \u25bc\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502  Post-   \u2502\n    \u2502 Script   \u2502\n    \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502  Update      \u2502\n    \u2502  State with  \u2502\n    \u2502  New GUID    \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"configuration/deployments/#the-deploymentguid-mechanism-explained","title":"The deploymentGuid Mechanism Explained","text":"<p>The <code>deploymentGuid</code> is CloudGrip's deployment version control mechanism:</p> <p>State Tracking:</p> <ul> <li>Pipeline maintains a state file/database</li> <li>After each successful deployment, stores: <code>{ deploymentName: guid }</code></li> <li>Example state: <code>{ \"storage-infrastructure\": \"a1b2c3d4\" }</code></li> </ul> <p>Deployment Decision Logic:</p> <pre><code>FOR EACH deployment in deployments:\n  current_guid = deployment.deploymentGuid\n  last_deployed_guid = state.get(deployment.name)\n\n  IF current_guid == last_deployed_guid:\n    LOG \"Deployment {deployment.name}: GUID unchanged, skipping\"\n    CONTINUE\n\n  IF current_guid != last_deployed_guid:\n    LOG \"Deployment {deployment.name}: GUID changed from {last_deployed_guid} to {current_guid}\"\n    EXECUTE_DEPLOYMENT(deployment)\n    state.set(deployment.name, current_guid)\n</code></pre> <p>Why This Design:</p> <ol> <li>Explicit Versioning: You control when deployments happen</li> <li>Prevents Unnecessary Work: Saves time and Azure API calls</li> <li>Predictable Behavior: No surprises from automatic redeployments</li> <li>Cost Optimization: Reduces deployment frequency</li> <li>Audit Trail: GUID changes visible in Git history</li> </ol> <p>Practical Example:</p> <pre><code>// Initial deployment\n{\n  \"name\": \"app-infrastructure\",\n  \"deploymentGuid\": \"00000001\",\n  \"templateFilePath\": \"app.bicep\"\n}\n// Deployment runs \u2192 State: { \"app-infrastructure\": \"00000001\" }\n\n// Update template, don't deploy yet\n{\n  \"name\": \"app-infrastructure\",\n  \"deploymentGuid\": \"00000001\",  // SAME\n  \"templateFilePath\": \"app.bicep\"  // Modified template\n}\n// Pipeline skips \u2192 No deployment\n\n// Ready to deploy changes\n{\n  \"name\": \"app-infrastructure\",\n  \"deploymentGuid\": \"00000002\",  // CHANGED\n  \"templateFilePath\": \"app.bicep\"\n}\n// Pipeline deploys \u2192 State: { \"app-infrastructure\": \"00000002\" }\n</code></pre>"},{"location":"configuration/deployments/#monitoring-and-troubleshooting","title":"Monitoring and Troubleshooting","text":"<p>Pipeline Logs: Available in your CI/CD platform</p> <ul> <li>Detailed deployment execution logs</li> <li>GUID comparison results</li> <li>Pre/post script output</li> <li>Deployment success/failure status</li> </ul> <p>Common Issues:</p> Issue Cause Solution Deployment skipped unexpectedly <code>deploymentGuid</code> not changed Generate new 8-char hex GUID Template validation failed Invalid Bicep/ARM syntax Run <code>az bicep build</code> or ARM validation locally Pre-script failed Script error or missing dependencies Test script locally, check permissions RBAC assignment failed Invalid email/group name or insufficient pipeline permissions Verify Azure AD objects exist, check pipeline SPN permissions Resource group not found <code>resourceGroupName</code> doesn't exist Create RG first or use template that creates it <p>Generating deploymentGuid Values:</p> <pre><code># Random 8-char hex\nopenssl rand -hex 4\n\n# Timestamp-based (YYYYMMDD in hex)\necho \"obase=16; $(date +%Y%m%d)\" | bc | tr '[:upper:]' '[:lower:]'\n\n# Sequential\n# Manually increment: 00000001 \u2192 00000002 \u2192 00000003...\n</code></pre> <pre><code># Random 8-char hex\n-join ((0..7) | ForEach-Object { '{0:x}' -f (Get-Random -Max 16) })\n\n# Timestamp-based\n[Convert]::ToString((Get-Date -Format 'yyyyMMdd'), 16).ToLower()\n\n#Using GUID\n((New-Guid) -replace '-').SubString(0, 8)\n</code></pre>"},{"location":"configuration/deployments/#summary","title":"Summary","text":"<p>CloudGrip provides enterprise-grade Azure infrastructure management through:</p> <ul> <li>Hierarchical Configuration: Tenant \u2192 Management Group \u2192 Subscription structure</li> <li>Schema Validation: JSON schemas ensure configuration correctness</li> <li>Multi-Technology Support: Deploy using Bicep, ARM, or Terraform</li> <li>Deployment Versioning: <code>deploymentGuid</code> provides explicit deployment control</li> <li>RBAC Integration: Manage access at all hierarchy levels</li> <li>Pipeline Automation: Git-driven deployments with change detection</li> </ul>"},{"location":"configuration/deployments/#key-takeaways","title":"Key Takeaways","text":"<ol> <li>deploymentGuid is Critical: Always change it when you want to deploy template changes</li> <li>Schema Compliance: Validate configurations against CloudGrip schemas</li> <li>Hierarchy Matters: Understand RBAC and policy inheritance</li> <li>Use Appropriate Scope: Deploy resources at subscription level via deployments array</li> <li>Version Control Everything: All configuration in Git for audit trail</li> <li>Test First: Use non-production environments before production changes</li> </ol>"},{"location":"configuration/deployments/#configuration-file-locations","title":"Configuration File Locations","text":"<p>Remember: When you want infrastructure changes deployed, always update the <code>deploymentGuid</code> in your deployment configuration. This simple 8-character hex value is what triggers the pipeline to execute your deployment.</p> <p>For detailed schema references, see:</p> <ul> <li>Tenant schema: <code>http://schema.ca8.io/schemas/2024-01-01/tenant.json</code></li> <li>Management Group schema: <code>http://schema.ca8.io/schemas/2024-01-01/managementgroup.json</code></li> <li>Subscription schema: <code>http://schema.ca8.io/schemas/2024-01-01/subscription.json</code></li> </ul>"},{"location":"configuration/pre-post-deploymentscripts/","title":"Pre and Post Deployment Scripts","text":"<p>CloudGrip supports PowerShell scripts that run before and after deployment execution, providing hooks for custom logic, validation, and post-deployment configuration.</p>"},{"location":"configuration/pre-post-deploymentscripts/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Overview</li> <li>Script Configuration</li> <li>Script Parameters</li> <li>Parameter Objects Reference</li> <li>Pre-Deployment Scripts</li> <li>Post-Deployment Scripts</li> <li>Best Practices</li> <li>Common Use Cases</li> <li>Examples</li> </ul>"},{"location":"configuration/pre-post-deploymentscripts/#overview","title":"Overview","text":"<p>Pre and post deployment scripts are PowerShell scripts that execute as part of the CloudGrip deployment pipeline:</p> <ul> <li>Pre-Deployment Scripts (<code>preScriptPath</code>): Run before the template deployment</li> <li>Post-Deployment Scripts (<code>postScriptPath</code>): Run after successful template deployment</li> </ul> <p>These scripts receive structured objects from the pipeline containing deployment configuration, subscription details, and file paths.</p>"},{"location":"configuration/pre-post-deploymentscripts/#script-configuration","title":"Script Configuration","text":"<p>Scripts are configured in the deployment object within your subscription configuration:</p> <pre><code>{\n  \"deployments\": [\n    {\n      \"name\": \"storage-infrastructure\",\n      \"type\": \"bicep\",\n      \"templateFilePath\": \"storage/main.bicep\",\n      \"templateParameterFilePath\": \"storage/main.prod.bicepparam\",\n      \"deploymentGuid\": \"a1b2c3d4\",\n      \"resourceGroupName\": \"rg-storage-prod\",\n      \"preScriptPath\": \"storage/pre.ps1\",\n      \"postScriptPath\": \"storage/post.ps1\"\n    }\n  ]\n}\n</code></pre> <p>Path Resolution:</p> <ul> <li>Paths are relative to the deployment's folder location</li> <li>Can be absolute paths or relative to repository root</li> <li>Scripts must be PowerShell (<code>.ps1</code>) files</li> </ul>"},{"location":"configuration/pre-post-deploymentscripts/#script-parameters","title":"Script Parameters","text":"<p>All CloudGrip deployment scripts receive four mandatory parameters from the pipeline:</p> <pre><code>param (\n  [Parameter(Mandatory)]\n  [pscustomobject] $Deployment,\n\n  [Parameter(Mandatory)]\n  [pscustomobject] $Subscription,\n\n  [Parameter(Mandatory)]\n  [pscustomobject] $TemplateFile,\n\n  [Parameter(Mandatory)]\n  [pscustomobject] $TemplateParameterFile,\n\n  [Parameter(ValueFromRemainingArguments)]\n  $RemainingArgs\n)\n</code></pre>"},{"location":"configuration/pre-post-deploymentscripts/#parameter-overview","title":"Parameter Overview","text":"Parameter Type Description Source <code>$Deployment</code> PSCustomObject The deployment configuration object Parsed from subscription JSON <code>$Subscription</code> PSCustomObject The subscription configuration object Parsed from subscription JSON <code>$TemplateFile</code> String Path to the template file Deployment configuration <code>$TemplateParameterFile</code> String Path to the parameter file Deployment configuration <code>$RemainingArgs</code> Array Catches any additional arguments Pipeline extensibility"},{"location":"configuration/pre-post-deploymentscripts/#parameter-objects-reference","title":"Parameter Objects Reference","text":""},{"location":"configuration/pre-post-deploymentscripts/#deployment-parameter","title":"<code>$Deployment</code> Parameter","text":"<p>The <code>$Deployment</code> object contains the complete deployment configuration from your subscription JSON file.</p> <p>Object Structure:</p> <pre><code>$Deployment = @{\n    name                      = \"storage-infrastructure\"\n    type                      = \"bicep\"\n    templateFilePath          = \"storage/main.bicep\"\n    templateParameterFilePath = \"storage/main.prod.bicepparam\"\n    deploymentGuid            = \"a1b2c3d4\"\n    resourceGroupName         = \"rg-storage-prod\"\n    preScriptPath             = \"storage/pre.ps1\"\n    postScriptPath            = \"storage/post.ps1\"\n}\n</code></pre> <p>Available Properties:</p> Property Type Description Always Present <code>name</code> String Deployment name \u2705 Yes <code>type</code> String Deployment type (<code>bicep</code>, <code>arm</code>, <code>terraform</code>) \u2705 Yes <code>deploymentGuid</code> String 8-character deployment version GUID \u2705 Yes <code>templateFilePath</code> String Path to template file \u2705 (except terraform) <code>templateParameterFilePath</code> String Path to parameter file \u26a0\ufe0f Optional <code>resourceGroupName</code> String Target resource group \u26a0\ufe0f Optional <code>preScriptPath</code> String Path to pre-deployment script \u26a0\ufe0f Optional <code>postScriptPath</code> String Path to post-deployment script \u26a0\ufe0f Optional <p>Usage Examples:</p> <pre><code># Access deployment name\nWrite-Information \"Deploying: $($Deployment.name)\"\n\n# Check deployment type\nif ($Deployment.type -eq \"bicep\") {\n    # Bicep-specific logic\n}\n\n# Get resource group\n$resourceGroup = $Deployment.resourceGroupName\n\n# Access deployment GUID for logging\nWrite-Information \"Deployment version: $($Deployment.deploymentGuid)\"\n</code></pre> <p>In Post-Deployment Scripts, the <code>$Deployment</code> object also includes deployment outputs:</p> <pre><code># Access deployment outputs (post-script only)\n$Deployment.Outputs.outStorageAccountName.value\n$Deployment.Outputs.outStorageAccountId.value\n$Deployment.Outputs.outPrimaryEndpoints.value\n</code></pre>"},{"location":"configuration/pre-post-deploymentscripts/#subscription-parameter","title":"<code>$Subscription</code> Parameter","text":"<p>The <code>$Subscription</code> object contains the complete subscription configuration.</p> <p>Object Structure:</p> <pre><code>$Subscription = @{\n    '$schema'                = \"http://schema.ca8.io/schemas/2024-01-01/subscription.json\"\n    tenantId                 = \"12345678-1234-1234-1234-123456789012\"\n    parentManagementGroupId  = \"mg-production\"\n    subscriptionName         = \"prod-workloads\"\n    subscriptionId           = \"87654321-4321-4321-4321-210987654321\"\n    location                 = \"westeurope\"\n    centralConfig            = @{\n        vnetResourceId = \"/subscriptions/.../virtualNetworks/vnet-prod\"\n        lawsResourceId = \"/subscriptions/.../workspaces/laws-prod\"\n    }\n    deployments              = @(...)  # Array of all deployments\n    tags                     = @{\n        environment = \"production\"\n        costCenter  = \"IT-001\"\n    }\n    rbac                     = @(...)  # Array of RBAC assignments\n    marketPlaceFeatures      = @()\n}\n</code></pre> <p>Available Properties:</p> Property Type Description <code>$schema</code> String Schema URI for validation <code>tenantId</code> String (GUID) Azure AD tenant ID <code>parentManagementGroupId</code> String Parent management group ID <code>subscriptionName</code> String Subscription display name <code>subscriptionId</code> String (GUID) Azure subscription ID <code>location</code> String Default Azure region <code>centralConfig</code> Object Shared infrastructure references <code>deployments</code> Array All deployment configurations <code>tags</code> Object Subscription-level tags <code>rbac</code> Array RBAC assignments <code>marketPlaceFeatures</code> Array Marketplace features <p>Usage Examples:</p> <pre><code># Get subscription details\n$subscriptionId = $Subscription.subscriptionId\n$location = $Subscription.location\n\nWrite-Information \"Deploying to subscription: $($Subscription.subscriptionName)\"\nWrite-Information \"Target region: $location\"\n\n# Access central configuration\n$vnetId = $Subscription.centralConfig.vnetResourceId\n$lawsId = $Subscription.centralConfig.lawsResourceId\n\n# Use subscription tags\n$environment = $Subscription.tags.environment\nif ($environment -eq \"production\") {\n    # Production-specific logic\n}\n\n# Find other deployments\n$otherDeployments = $Subscription.deployments | Where-Object { $_.name -ne $Deployment.name }\n</code></pre>"},{"location":"configuration/pre-post-deploymentscripts/#templatefile-parameter","title":"<code>$TemplateFile</code> Parameter","text":"<p>A string containing the absolute or relative path to the template file.</p> <p>Value Examples:</p> <pre><code># Bicep template\n$TemplateFile = \"storage/main.bicep\"\n\n# ARM template\n$TemplateFile = \"network/vnet.json\"\n\n# Absolute path\n$TemplateFile = \"/Users/mark-s/Repos/cloudautom8/cloudgrip/config/Azure/storage/main.bicep\"\n</code></pre> <p>Usage:</p> <pre><code># Check if file exists\nif (Test-Path $TemplateFile) {\n    Write-Information \"Template found: $TemplateFile\"\n}\n\n# Get file details\n$templateInfo = Get-Item $TemplateFile\nWrite-Information \"Template size: $($templateInfo.Length) bytes\"\n\n# Read template content (for validation)\n$templateContent = Get-Content $TemplateFile -Raw\n</code></pre>"},{"location":"configuration/pre-post-deploymentscripts/#templateparameterfile-parameter","title":"<code>$TemplateParameterFile</code> Parameter","text":"<p>A string containing the path to the parameter file (Bicep <code>.bicepparam</code> or ARM <code>.parameters.json</code>).</p> <p>Value Examples:</p> <pre><code># Bicep parameter file\n$TemplateParameterFile = \"storage/main.prod.bicepparam\"\n\n# ARM parameter file\n$TemplateParameterFile = \"network/vnet.parameters.json\"\n</code></pre> <p>Usage:</p> <pre><code># Check parameter file type\nif ($TemplateParameterFile -like \"*.bicepparam\") {\n    Write-Information \"Using Bicep parameter file\"\n} elseif ($TemplateParameterFile -like \"*.parameters.json\") {\n    Write-Information \"Using ARM parameter file\"\n}\n\n# Read parameters (see examples below)\n</code></pre>"},{"location":"configuration/pre-post-deploymentscripts/#pre-deployment-scripts","title":"Pre-Deployment Scripts","text":"<p>Pre-deployment scripts run before the template deployment executes.</p>"},{"location":"configuration/pre-post-deploymentscripts/#purpose","title":"Purpose","text":"<ul> <li>Validation: Check prerequisites and environment readiness</li> <li>Preparation: Set up resources or configuration needed by the deployment</li> <li>Parameter Extraction: Read and validate template parameters</li> <li>Resource Checks: Verify required resources exist</li> <li>Secret Retrieval: Get secrets from Key Vault to pass to deployment</li> </ul>"},{"location":"configuration/pre-post-deploymentscripts/#script-template","title":"Script Template","text":"<pre><code># filepath: pre.ps1\n&lt;#\n  .SYNOPSIS\n  Pre-deployment script for CloudGrip deployment\n\n  .DESCRIPTION\n  Runs before template deployment to validate and prepare environment\n\n  .PARAMETER Deployment\n  The deployment configuration object from subscription JSON\n\n  .PARAMETER Subscription\n  The subscription configuration object from subscription JSON\n\n  .PARAMETER TemplateFile\n  Path to the ARM/Bicep template file\n\n  .PARAMETER TemplateParameterFile\n  Path to the parameter file\n\n  .PARAMETER RemainingArgs\n  Additional arguments from pipeline\n#&gt;\n\nparam (\n  [Parameter(Mandatory)]\n  [pscustomobject] $Deployment,\n\n  [Parameter(Mandatory)]\n  [pscustomobject] $Subscription,\n\n  [Parameter(Mandatory)]\n  [string] $TemplateFile,\n\n  [Parameter(Mandatory)]\n  [string] $TemplateParameterFile,\n\n  [Parameter(ValueFromRemainingArguments)]\n  $RemainingArgs\n)\n\nbegin {\n  Write-Information -MessageData \"Started pre-deployment script for: $($Deployment.name)\"\n}\n\nprocess {\n  try {\n    # Your pre-deployment logic here\n\n    # Return data to post-deployment script if needed\n    return @{\n      PreDeploymentTimestamp = Get-Date\n      ValidatedParameters = $true\n    }\n  }\n  catch {\n    Write-Error -Message \"Pre-deployment failed: $_\" -ErrorAction Stop\n  }\n}\n\nend {\n  Write-Information -MessageData \"Finished pre-deployment script\"\n}\n</code></pre>"},{"location":"configuration/pre-post-deploymentscripts/#return-values","title":"Return Values","text":"<p>Pre-deployment scripts can return data that will be available to post-deployment scripts:</p> <pre><code># In pre-deployment script\nreturn @{\n    resourcesCreated = @(\"resource1\", \"resource2\")\n    validationPassed = $true\n    timestamp = Get-Date\n}\n\n# This data becomes available in post-deployment context\n</code></pre>"},{"location":"configuration/pre-post-deploymentscripts/#post-deployment-scripts","title":"Post-Deployment Scripts","text":"<p>Post-deployment scripts run after successful template deployment.</p>"},{"location":"configuration/pre-post-deploymentscripts/#purpose_1","title":"Purpose","text":"<ul> <li>Configuration: Apply settings not possible in templates</li> <li>Integration: Connect deployed resources to external systems</li> <li>Validation: Verify deployment success and resource health</li> <li>Notification: Send deployment completion alerts</li> <li>Cleanup: Remove temporary resources or configurations</li> <li>Documentation: Extract and store deployment outputs</li> </ul>"},{"location":"configuration/pre-post-deploymentscripts/#script-template_1","title":"Script Template","text":"<pre><code># filepath: post.ps1\n&lt;#\n  .SYNOPSIS\n  Post-deployment script for CloudGrip deployment\n\n  .DESCRIPTION\n  Runs after successful template deployment for configuration and validation\n\n  .PARAMETER Deployment\n  The deployment configuration object including deployment outputs\n\n  .PARAMETER Subscription\n  The subscription configuration object\n\n  .PARAMETER TemplateFile\n  Path to the deployed template file\n\n  .PARAMETER TemplateParameterFile\n  Path to the parameter file used\n\n  .PARAMETER RemainingArgs\n  Additional arguments from pipeline\n#&gt;\n\nparam (\n  [Parameter(Mandatory)]\n  [pscustomobject] $Deployment,\n\n  [Parameter(Mandatory)]\n  [pscustomobject] $Subscription,\n\n  [Parameter(Mandatory)]\n  [string] $TemplateFile,\n\n  [Parameter(Mandatory)]\n  [string] $TemplateParameterFile,\n\n  [Parameter(ValueFromRemainingArguments)]\n  $RemainingArgs\n)\n\nbegin {\n  Write-Information -MessageData \"Started post-deployment script for: $($Deployment.name)\"\n}\n\nprocess {\n  try {\n    # Access deployment outputs\n    $storageAccountName = $Deployment.Outputs.outStorageAccountName.value\n\n    Write-Information \"Deployed storage account: $storageAccountName\"\n\n    # Your post-deployment logic here\n  }\n  catch {\n    Write-Error -Message \"Post-deployment failed: $_\" -ErrorAction Stop\n  }\n}\n\nend {\n  Write-Information -MessageData \"Finished post-deployment script\"\n}\n</code></pre>"},{"location":"configuration/pre-post-deploymentscripts/#accessing-deployment-outputs","title":"Accessing Deployment Outputs","text":"<p>In post-deployment scripts, the <code>$Deployment.Outputs</code> property contains all template outputs:</p> <pre><code># Access outputs defined in Bicep/ARM template\n$storageAccountName = $Deployment.Outputs.outStorageAccountName.value\n$storageAccountId = $Deployment.Outputs.outStorageAccountId.value\n$primaryEndpoint = $Deployment.Outputs.outPrimaryBlobEndpoint.value\n\n# Check if output exists\nif ($Deployment.Outputs.PSObject.Properties.Name -contains \"outStorageAccountName\") {\n    $name = $Deployment.Outputs.outStorageAccountName.value\n}\n\n# Iterate all outputs\nforeach ($output in $Deployment.Outputs.PSObject.Properties) {\n    Write-Information \"$($output.Name): $($output.Value.value)\"\n}\n</code></pre>"},{"location":"configuration/pre-post-deploymentscripts/#best-practices","title":"Best Practices","text":""},{"location":"configuration/pre-post-deploymentscripts/#script-structure","title":"Script Structure","text":"<ol> <li>Use Proper Parameter Blocks</li> </ol> <pre><code># Always use typed parameters with [Parameter(Mandatory)]\nparam (\n  [Parameter(Mandatory)]\n  [pscustomobject] $Deployment,\n  # ...\n)\n</code></pre> <ol> <li>Include Begin/Process/End Blocks</li> </ol> <pre><code>begin {\n  # Initialization\n}\nprocess {\n  # Main logic wrapped in try/catch\n}\nend {\n  # Cleanup\n}\n</code></pre> <ol> <li>Implement Error Handling</li> </ol> <pre><code>try {\n  # Your logic\n}\ncatch {\n  Write-Error -Message \"Error: $_\" -ErrorAction Stop\n}\n</code></pre>"},{"location":"configuration/pre-post-deploymentscripts/#logging","title":"Logging","text":"<p>Use <code>Write-Information</code> for logging (captured by pipeline):</p> <pre><code>Write-Information -MessageData \"Processing deployment: $($Deployment.name)\" -InformationAction Continue\n\n# Log object details\nWrite-Information -MessageData (ConvertTo-Json $Deployment -Depth 10)\n</code></pre>"},{"location":"configuration/pre-post-deploymentscripts/#parameter-validation","title":"Parameter Validation","text":"<pre><code># Validate required properties exist\nif (-not $Deployment.resourceGroupName) {\n    Write-Error \"Resource group name is required\" -ErrorAction Stop\n}\n\n# Validate subscription context\nif ($Subscription.subscriptionId -ne (Get-AzContext).Subscription.Id) {\n    Write-Error \"Wrong subscription context\" -ErrorAction Stop\n}\n</code></pre>"},{"location":"configuration/pre-post-deploymentscripts/#idempotency","title":"Idempotency","text":"<p>Make scripts idempotent (safe to run multiple times):</p> <pre><code># Check if resource exists before creating\n$resource = Get-AzResource -Name $name -ResourceGroupName $rg -ErrorAction SilentlyContinue\nif (-not $resource) {\n    # Create resource\n}\n</code></pre>"},{"location":"configuration/pre-post-deploymentscripts/#common-use-cases","title":"Common Use Cases","text":""},{"location":"configuration/pre-post-deploymentscripts/#1-reading-bicep-parameters","title":"1. Reading Bicep Parameters","text":"<p>Extract parameters from Bicep parameter file in pre-deployment:</p> <pre><code># Build Bicep parameters to JSON\nbicep build-params $TemplateParameterFile --outfile ./temp-params.json\n\n# Read parameters\n$paramsObject = Get-Content ./temp-params.json -Raw | ConvertFrom-Json\n$storageAccountName = $paramsObject.parameters.parStorageAccountName.value\n\nWrite-Information \"Storage account name: $storageAccountName\"\n\n# Cleanup temp file\nRemove-Item ./temp-params.json -Force\n</code></pre>"},{"location":"configuration/pre-post-deploymentscripts/#2-reading-arm-parameters","title":"2. Reading ARM Parameters","text":"<pre><code># Read ARM parameter file\n$paramsObject = Get-Content $TemplateParameterFile -Raw | ConvertFrom-Json\n$parameters = $paramsObject.parameters\n\n# Access specific parameter\n$sku = $parameters.storageAccountSku.value\n</code></pre>"},{"location":"configuration/pre-post-deploymentscripts/#3-validating-resource-group-exists","title":"3. Validating Resource Group Exists","text":"<pre><code># Pre-deployment: Ensure resource group exists\n$rgName = $Deployment.resourceGroupName\n$rg = Get-AzResourceGroup -Name $rgName -ErrorAction SilentlyContinue\n\nif (-not $rg) {\n    Write-Information \"Creating resource group: $rgName\" -InformationAction Continue\n    New-AzResourceGroup -Name $rgName -Location $Subscription.location -Tag $Subscription.tags\n}\n</code></pre>"},{"location":"configuration/pre-post-deploymentscripts/#4-retrieving-secrets-from-key-vault","title":"4. Retrieving Secrets from Key Vault","text":"<pre><code># Get Key Vault reference from central config\n$keyVaultId = $Subscription.centralConfig.keyVaultResourceId\n\n# Parse Key Vault name from resource ID\n$kvName = ($keyVaultId -split '/')[-1]\n\n# Retrieve secret\n$secret = Get-AzKeyVaultSecret -VaultName $kvName -Name \"DatabasePassword\" -AsPlainText\n\n# Use secret (ensure not logged)\n# Pass to deployment or use in post-configuration\n</code></pre>"},{"location":"configuration/pre-post-deploymentscripts/#5-configuring-deployed-resources","title":"5. Configuring Deployed Resources","text":"<pre><code># Post-deployment: Configure storage account settings\n$storageAccountName = $Deployment.Outputs.outStorageAccountName.value\n$rgName = $Deployment.resourceGroupName\n\n# Enable blob versioning (not available in ARM/Bicep at time of writing)\n$storageAccount = Get-AzStorageAccount -ResourceGroupName $rgName -Name $storageAccountName\nEnable-AzStorageBlobDeleteRetentionPolicy -ResourceGroupName $rgName `\n    -StorageAccountName $storageAccountName `\n    -RetentionDays 30\n\nWrite-Information \"Configured retention policy for: $storageAccountName\"\n</code></pre>"},{"location":"configuration/pre-post-deploymentscripts/#6-sending-notifications","title":"6. Sending Notifications","text":"<pre><code># Post-deployment: Send Teams notification\n$webhook = $env:TEAMS_WEBHOOK_URL\n\n$message = @{\n    text = \"Deployment completed: $($Deployment.name) in $($Subscription.subscriptionName)\"\n} | ConvertTo-Json\n\nInvoke-RestMethod -Uri $webhook -Method Post -Body $message -ContentType 'application/json'\n</code></pre>"},{"location":"configuration/pre-post-deploymentscripts/#7-creating-custom-monitoring","title":"7. Creating Custom Monitoring","text":"<pre><code># Post-deployment: Create custom metric alert\n$storageAccountId = $Deployment.Outputs.outStorageAccountId.value\n\n$actionGroup = Get-AzActionGroup -ResourceGroupName \"rg-monitoring\" -Name \"ag-alerts\"\n\n$criteria = New-AzMetricAlertRuleV2Criteria `\n    -MetricName \"UsedCapacity\" `\n    -TimeAggregation Average `\n    -Operator GreaterThan `\n    -Threshold 1000000000\n\nAdd-AzMetricAlertRuleV2 `\n    -Name \"alert-storage-capacity\" `\n    -ResourceGroupName $Deployment.resourceGroupName `\n    -TargetResourceId $storageAccountId `\n    -Condition $criteria `\n    -ActionGroupId $actionGroup.Id `\n    -Severity 3\n</code></pre>"},{"location":"configuration/pre-post-deploymentscripts/#examples","title":"Examples","text":""},{"location":"configuration/pre-post-deploymentscripts/#complete-pre-deployment-script-example","title":"Complete Pre-Deployment Script Example","text":"<pre><code># filepath: storage/pre.ps1\nparam (\n  [Parameter(Mandatory)]\n  [pscustomobject] $Deployment,\n\n  [Parameter(Mandatory)]\n  [pscustomobject] $Subscription,\n\n  [Parameter(Mandatory)]\n  [string] $TemplateFile,\n\n  [Parameter(Mandatory)]\n  [string] $TemplateParameterFile,\n\n  [Parameter(ValueFromRemainingArguments)]\n  $RemainingArgs\n)\n\nbegin {\n  Write-Information -MessageData \"=== Pre-Deployment: $($Deployment.name) ===\" -InformationAction Continue\n}\n\nprocess {\n  try {\n    #region Validate Context\n    $currentContext = Get-AzContext\n    if ($currentContext.Subscription.Id -ne $Subscription.subscriptionId) {\n        Write-Error \"Wrong subscription context. Expected: $($Subscription.subscriptionId)\" -ErrorAction Stop\n    }\n    #endregion\n\n    #region Extract Parameters\n    Write-Information \"Extracting parameters from: $TemplateParameterFile\"\n\n    bicep build-params $TemplateParameterFile --outfile ./temp-params.json\n    $paramsObject = Get-Content ./temp-params.json -Raw | ConvertFrom-Json\n    $parameters = $paramsObject.parameters\n\n    $storageAccountName = $parameters.parStorageAccountName.value\n    Write-Information \"Storage Account Name: $storageAccountName\" -InformationAction Continue\n\n    Remove-Item ./temp-params.json -Force\n    #endregion\n\n    #region Validate Resource Group\n    $rgName = $Deployment.resourceGroupName\n    $rg = Get-AzResourceGroup -Name $rgName -ErrorAction SilentlyContinue\n\n    if (-not $rg) {\n        Write-Information \"Creating resource group: $rgName\" -InformationAction Continue\n        New-AzResourceGroup -Name $rgName -Location $Subscription.location -Tag $Subscription.tags\n    }\n    #endregion\n\n    #region Check Storage Account Name Availability\n    $nameAvailable = Get-AzStorageAccountNameAvailability -Name $storageAccountName\n    if (-not $nameAvailable.NameAvailable) {\n        Write-Error \"Storage account name '$storageAccountName' is not available: $($nameAvailable.Reason)\" -ErrorAction Stop\n    }\n    #endregion\n\n    # Return validation results\n    return @{\n        ValidationPassed = $true\n        StorageAccountName = $storageAccountName\n        ResourceGroupCreated = ($null -eq $rg)\n        Timestamp = Get-Date\n    }\n  }\n  catch {\n    Write-Error -Message \"Pre-deployment validation failed: $_\" -ErrorAction Stop\n  }\n}\n\nend {\n  Write-Information -MessageData \"=== Pre-Deployment Complete ===\" -InformationAction Continue\n}\n</code></pre>"},{"location":"configuration/pre-post-deploymentscripts/#complete-post-deployment-script-example","title":"Complete Post-Deployment Script Example","text":"<pre><code># filepath: storage/post.ps1\nparam (\n  [Parameter(Mandatory)]\n  [pscustomobject] $Deployment,\n\n  [Parameter(Mandatory)]\n  [pscustomobject] $Subscription,\n\n  [Parameter(Mandatory)]\n  [string] $TemplateFile,\n\n  [Parameter(Mandatory)]\n  [string] $TemplateParameterFile,\n\n  [Parameter(ValueFromRemainingArguments)]\n  $RemainingArgs\n)\n\nbegin {\n  Write-Information -MessageData \"=== Post-Deployment: $($Deployment.name) ===\" -InformationAction Continue\n}\n\nprocess {\n  try {\n    #region Extract Deployment Outputs\n    if (-not $Deployment.Outputs) {\n        Write-Error \"No deployment outputs available\" -ErrorAction Stop\n    }\n\n    $storageAccountName = $Deployment.Outputs.outStorageAccountName.value\n    $storageAccountId = $Deployment.Outputs.outStorageAccountId.value\n    $primaryEndpoint = $Deployment.Outputs.outPrimaryBlobEndpoint.value\n\n    Write-Information \"Deployed Storage Account: $storageAccountName\" -InformationAction Continue\n    Write-Information \"Resource ID: $storageAccountId\" -InformationAction Continue\n    Write-Information \"Primary Endpoint: $primaryEndpoint\" -InformationAction Continue\n    #endregion\n\n    #region Configure Advanced Settings\n    Write-Information \"Configuring blob retention policy...\" -InformationAction Continue\n\n    $storageAccount = Get-AzStorageAccount `\n        -ResourceGroupName $Deployment.resourceGroupName `\n        -Name $storageAccountName\n\n    # Enable soft delete for blobs\n    Enable-AzStorageBlobDeleteRetentionPolicy `\n        -ResourceGroupName $Deployment.resourceGroupName `\n        -StorageAccountName $storageAccountName `\n        -RetentionDays 7\n\n    Write-Information \"Retention policy configured\" -InformationAction Continue\n    #endregion\n\n    #region Create Monitoring Alert\n    if ($Subscription.centralConfig.PSObject.Properties.Name -contains 'actionGroupId') {\n        Write-Information \"Creating capacity alert...\" -InformationAction Continue\n\n        $criteria = New-AzMetricAlertRuleV2Criteria `\n            -MetricName \"UsedCapacity\" `\n            -TimeAggregation Total `\n            -Operator GreaterThan `\n            -Threshold 900000000000  # 900 GB\n\n        Add-AzMetricAlertRuleV2 `\n            -Name \"alert-$storageAccountName-capacity\" `\n            -ResourceGroupName $Deployment.resourceGroupName `\n            -TargetResourceId $storageAccountId `\n            -Condition $criteria `\n            -ActionGroupId $Subscription.centralConfig.actionGroupId `\n            -Severity 2 `\n            -WindowSize (New-TimeSpan -Hours 1) `\n            -Frequency (New-TimeSpan -Minutes 15)\n\n        Write-Information \"Alert created successfully\" -InformationAction Continue\n    }\n    #endregion\n\n    #region Send Completion Notification\n    $message = @\"\nDeployment Completed Successfully\n\nDeployment: $($Deployment.name)\nSubscription: $($Subscription.subscriptionName)\nResource Group: $($Deployment.resourceGroupName)\nStorage Account: $storageAccountName\nDeployment GUID: $($Deployment.deploymentGuid)\nTimestamp: $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')\n\"@\n\n    Write-Information $message -InformationAction Continue\n    #endregion\n  }\n  catch {\n    Write-Error -Message \"Post-deployment configuration failed: $_\" -ErrorAction Stop\n  }\n}\n\nend {\n  Write-Information -MessageData \"=== Post-Deployment Complete ===\" -InformationAction Continue\n}\n</code></pre>"},{"location":"configuration/pre-post-deploymentscripts/#summary","title":"Summary","text":"<p>CloudGrip pre and post deployment scripts provide powerful extension points in the deployment pipeline:</p> <ul> <li>Four Standard Parameters: <code>$Deployment</code>, <code>$Subscription</code>, <code>$TemplateFile</code>, <code>$TemplateParameterFile</code></li> <li>Pipeline-Provided: All parameters automatically passed by CloudGrip pipeline</li> <li>Full Configuration Access: Complete deployment and subscription configuration available</li> <li>Deployment Outputs: Post-scripts can access all template outputs</li> <li>Flexible Logic: Implement validation, configuration, integration, and monitoring</li> <li>Error Handling: Use PowerShell best practices with try/catch blocks</li> <li>Logging: Use <code>Write-Information</code> for pipeline-captured logs</li> </ul> <p>These scripts enable complex deployment scenarios while maintaining the declarative nature of CloudGrip's infrastructure-as-code approach.</p>"},{"location":"getting-started/configuration/","title":"Configuration","text":""},{"location":"getting-started/configuration/#intro","title":"Intro","text":"<p>Once onboarding has completed and the \"CloudGrip - Deployment\" Service Principal is created, the configuration for Github or Azure DevOps can begin. Please follow the GitHub or Azure DevOps section below based on what you are using.</p> <p>If manual creation of the SPN is performed, the app registration name might vary in the documentation below.</p>"},{"location":"getting-started/configuration/#github","title":"GitHub","text":"<p>For using Github as CICD system we need to setup some variables in order to start using it. Credential delegation setup is already done. You can verify that the delegated credential setup is configured in Entra Id under app registrations. There is the \"CloudGrip - Deployment\" app registration: </p> <p>Next step is to configure the variables in Github Action variables. We need to create variables for the tenant id and the application id. Create 2 variables named:</p> Variable Name Description CLOUDGRIPAZURECLIENTID This is the Application (client) ID of the CloudGrip - Deployment app CLOUDGRIPAZURETENANTID This is the Directory (tenant) ID of the CloudGrip - Deployment app <p>For each supply the value that corresponds with your environment. Eventually the variables should look like this and you can reach the variable configuration via <code>settings -&gt; secrets and variables -&gt; actions -&gt; Repository Variables</code>: </p>"},{"location":"getting-started/configuration/#azure-devops","title":"Azure DevOps","text":"<p>When using Azure Devops as CICD system we need to setup a service connections. Credential delegation setup is already done. You can verify that the delegated credential setup is configured in Entra Id under app registrations. There is the \"CloudGrip - Deployment\" app registration: </p> <p>The service connection setup is explained with the following steps. In Azure DevOps go to your CloudGrip project and in the left bottom corner choose <code>Project Settings</code>, next under the Pipelines section search for <code>Service Connections</code> and select it. You either have the option to <code>Create New Service Connection</code> in the top right corner or in the main screen select <code>New Service Connection</code>. In the New Service Connection wizard choose <code>Azure Resource Manager</code>: </p> <p>Choose Workload Identity Federation (Manual) and click next: </p> <p>Define the Service connection name. This should be: <code>CloudGrip - Deployment</code> exact as written. If you cannot comply with this name you have to update the application registration federated credential settings with the correct Subject Identifier. This will then change to the name you have chosen.</p> <p>Leave the checkbox empty under the security settings empty and choose next: </p> <p>Finally fill in the other settings. The environment is <code>Azure Cloud</code>. CloudGrip is managing Azure by default from the root, so choose management group and fill in the management group id and name. By default the Root Management Group Id is the tenant Id and the name is 'Tenant Root Group' Finally fill in the application Id and the Tenant Id under the authentication settings and choose verify and safe. If you have choosen a different name for the service connection you can save it as draft and then update the settings in the SPN section. Once that is done you can go back to the service connection and validate the connection. </p> <p>Now the connection is ready for use in Azure DevOps Pipelines.</p>"},{"location":"getting-started/installation/","title":"Installation","text":""},{"location":"getting-started/installation/#install-powershell-module","title":"Install PowerShell Module","text":"<p>In order to get started with CloudGrip download the supporting Bootstrap PowerShell module and import it in your PowerShell session:</p> <pre><code>#Assuming that the downloaded module is in the same folder as the script. Adjust otherwise.\nExpand-Archive -Path './CA8.Bootstrap_0.1.0.zip' -DestinationPath './CA8.Bootstrap_0.1.0'\nImport-Module -Name ./CA8.Bootstrap_0.1.0/CA8.Bootstrap.psd1 -Verbose\n</code></pre> <p>It recommended that you create a new folder in your repositories or source folder structure where you usually clone or initiate new projects in. In that folder create a start.ps1 and copy the content above in it.</p> <p>This snippet will import the necessary cmdlets in order to get the repository for CloudGrip setup and set the permissions in Azure correctly for the pipelines.</p>"},{"location":"getting-started/installation/#scaffolding-cloudgrip-structure","title":"Scaffolding CloudGrip structure","text":"<p>The next step is to create a scaffolding folder structure for your config store.</p> <pre><code>#To create scaffolding for Azure DevOps\nNew-CA8CloudGripSetup -Path .\\cloudgrip-config-gh -DevOpsSystem GitHub \n\n#To create scaffolding for Github\nNew-CA8CloudGripSetup -Path .\\cloudgrip-config-azd -DevOpsSystem AzureDevOps\n</code></pre>"},{"location":"getting-started/installation/#configure-spn-and-azure-permissions","title":"Configure SPN and Azure Permissions","text":"<p>The final step for installation is to setup the \"CloudGrip - Setup\" Service Principal in your tenant and configure the right permissions for it. This SPN once configured correctly can setup the \"CloudGrip - Deployment\" service principal and can maintain and update the managed application deployed in your tenant that runs the CloudGrip software.</p> <p>You should be elevated to Global Administrator role to run the cmdlet below</p> <pre><code>#Create a new service principal and configure permissions for Azure\n#Replace '00000000-0000-0000-0000-000000000000' with your tenant id.\n\nRegister-CA8CloudGripSPN -TenantId '00000000-0000-0000-0000-000000000000'\n\n# &gt; \"CloudGrip SPN registered and permissions configured\"\n</code></pre> <p>The previous step will only configure the \"CloudGrip - Setup\" service principal. Once cmdlet returns <code>\"CloudGrip SPN registered and permissions configured\"</code> you can continue with deployment of the CloudGrip Azure MarketPlace item or if already available use the CloudGrip self service portal to initiate the deployment setup.</p> <p>The Service Principal in Entra Id is found under enterprise applications and should look like this:  application id and object id may vary</p> <p>You can manually configure permissions if needed. Please refer to the manual permissions setup.</p>"},{"location":"getting-started/installation/#deploy-cloudgrip-from-the-azure-marketplace","title":"Deploy CloudGrip from the Azure Marketplace","text":"<p>From the Azure Portal, go to the market place and search for CloudGrip. Next fill in the parameters and deploy CloudGrip into your environment.</p> <p></p>"},{"location":"getting-started/overview/","title":"Getting Started","text":"<p>In order to get started with CloudGrip couple of steps need to be performed. In a nutshell it contains these phases:</p> <ul> <li>Create GitHub or Azure DevOps repository for CloudGrip code base.</li> <li>Deploy CloudGrip from the Azure Marketplace.</li> <li>Download and install bootstrap PowerShell module.</li> <li>Configure SPN in your tenant and provide permissions.</li> <li>Create tenant structure in repository.</li> </ul> <p>After the install steps the situtation achieved is as following. A folder structure created for CloudGrip codebase: </p> <p>An SPN created for setup, maintenance and updates that should look like this:  application id and object id may vary</p>"},{"location":"setup/managementgroup/","title":"\ud83d\udcd8 Management Group Schema Documentation","text":"<pre><code>{\n  \"$schema\": \"http://schema.ca8.io/schemas/2024-01-01/managementgroup.json\",\n  \"tenantId\": \"00000000-0000-0000-0000-000000000000\",\n  \"parentManagementGroupId\": \"alz-platform\",\n  \"managementGroupId\": \"alz-platform-management\",\n  \"managementGroupName\": \"Platform\",\n  \"managementGroups\": [],\n  \"policy\": {\n    \"initiative\": [],\n    \"policy\": []\n  },\n  \"rbac\": [],\n  \"pimAssignments\": [],\n  \"subscriptions\": []\n}\n</code></pre> <p>Schema URL: <code>http://schema.ca8.io/schemas/2024-01-01/managementgroup.json</code> Version: 2024-01-01 Purpose: Describes the structure and configuration of a CloudGrip Management Group.</p>"},{"location":"setup/managementgroup/#top-level-structure","title":"\ud83d\udd17 Top-Level Structure","text":"Property Type Required Description <code>$schema</code> <code>string (uri)</code> \u2705 Fixed URI for this schema version. <code>tenantId</code> <code>uuid</code> \u2705 Azure Active Directory (AAD) Tenant ID. <code>parentManagementGroupId</code> <code>string</code> \u2705 ID of the parent management group. <code>managementGroupId</code> <code>string</code> \u2705 Unique identifier of the management group. <code>managementGroupName</code> <code>string</code> \u2705 Display name of the management group. <code>managementGroups</code> <code>array&lt;ManagementGroup&gt;</code> \u2705 Child management groups. <code>policy</code> <code>object</code> \u2705 Policy and initiative assignments. <code>rbac</code> <code>array&lt;RBAC&gt;</code> \u2705 RBAC roles assigned at the group level. <code>subscriptions</code> <code>array&lt;Subscription&gt;</code> \u2705 Subscriptions under this group. <code>pimAssignments</code> <code>array&lt;PIMAssignment&gt;</code> \u2b05\ufe0f optional Optional PIM assignment entries."},{"location":"setup/managementgroup/#management-group-definition","title":"\ud83e\udde9 Management Group Definition","text":""},{"location":"setup/managementgroup/#properties","title":"Properties","text":"Property Type Required Notes <code>name</code> <code>string</code> \u2705 Logical display name. <code>id</code> <code>string</code> \u2705 Short identifier (e.g. <code>alz</code>). <code>managedBy</code> <code>enum: parent/self</code> \u2705 Whether managed internally (<code>self</code>) or inherited. <code>repoUrl</code> <code>uri</code> \u26a0\ufe0f Required if <code>managedBy = self</code>. <code>ownerEmail</code> <code>email</code> \u26a0\ufe0f Required if <code>managedBy = self</code>."},{"location":"setup/managementgroup/#rbac","title":"\ud83d\udd10 RBAC","text":"<p>Role-Based Access Control entries.</p> Property Type Description <code>name</code> <code>string</code> Role name (e.g. Owner, Reader). <code>assignedUsers</code> <code>array&lt;email&gt;</code> Direct user access. <code>assignedGroups</code> <code>array&lt;string&gt;</code> Azure AD group names. <code>assignedSpnObjectIds</code> <code>array&lt;uuid&gt;</code> SPN object IDs for automation."},{"location":"setup/managementgroup/#policy","title":"\ud83d\udee1\ufe0f Policy","text":""},{"location":"setup/managementgroup/#structure","title":"Structure","text":"Key Type Description <code>initiative</code> <code>array</code> Policy initiatives to assign. <code>policy</code> <code>array</code> Individual policies to assign."},{"location":"setup/managementgroup/#subscription-definition","title":"\ud83d\udce6 Subscription Definition","text":"Property Type Required Notes <code>name</code> <code>string</code> \u2705 Name of the subscription. <code>id</code> <code>uuid</code> \u2705 Subscription GUID. <code>managedBy</code> <code>enum</code> \u2705 Either <code>parent</code> or <code>self</code>. <code>repoUrl</code> <code>uri</code> \u26a0\ufe0f Required if <code>managedBy = self</code>. <code>ownerEmail</code> <code>email</code> \u26a0\ufe0f Required if <code>managedBy = self</code>."},{"location":"setup/managementgroup/#pim-assignment-optional","title":"\ud83d\udd10 PIM Assignment (Optional)","text":"<p>Structure not explicitly defined in schema. Required fields include:</p> <ul> <li><code>name</code></li> <li><code>assignedUsers</code></li> <li><code>assignedGroups</code></li> <li><code>activationDurationHours</code></li> <li><code>activationRequirements</code></li> <li><code>activationAlertEmails</code></li> <li><code>activationApproverGroups</code></li> </ul> <p>Note: <code>\u26a0\ufe0f</code> indicates conditional requirement based on another field.</p>"},{"location":"setup/overview/","title":"\u2601\ufe0f CloudGrip Schema Overview","text":"<p>This documentation provides an overview of the JSON schema files that define the core structure of a CloudGrip-managed Azure environment. These files \u2014 <code>tenant.json</code>, <code>managementgroup.json</code>, and <code>subscription.json</code> \u2014 serve as declarative blueprints for provisioning and managing resources within Azure using standardized configuration files.</p>"},{"location":"setup/overview/#schema-files-overview","title":"\ud83d\udcc1 Schema Files Overview","text":"File Purpose Azure Equivalent <code>tenant.json</code> Defines the entire tenant-level structure including root management group and global policies. Azure AD Tenant and Root Management Group <code>managementgroup.json</code> Defines child management groups, their policies, RBAC, and subscriptions. Azure Management Group and related structure <code>subscription.json</code> Defines individual Azure subscriptions, including deployments, tags, RBAC, and marketplace features. Azure Subscription"},{"location":"setup/overview/#how-it-works","title":"\ud83e\uddf1 How It Works","text":"<p>These schemas represent the CloudGrip Configuration-as-Code model for enterprise-scale Azure architecture. Each layer builds upon the previous, allowing for a modular, auditable, and repeatable deployment pattern.</p>"},{"location":"setup/overview/#1-tenantjson-tenant-level-blueprint","title":"\ud83c\udfe2 1. <code>tenant.json</code>: Tenant-Level Blueprint","text":"<p>The <code>tenant.json</code> file represents the entry point into CloudGrip's configuration model. It outlines:</p> <ul> <li>Tenant Metadata: Name, ID, and primary domain.</li> <li>Root Management Group: The top-level group in the hierarchy.</li> <li>Global Policies and Roles: Security baselines, RBAC assignments.</li> <li>Centralized Marketplace Features: SaaS integrations or partner services.</li> <li>Initial Subscriptions: Bootstrapped under the root group.</li> </ul> <p>\ud83d\udd17 This correlates with your EntraId tenant and the top-level Root Management Group (<code>/providers/Microsoft.Management/managementGroups/{root}</code>)</p>"},{"location":"setup/overview/#2-managementgroupjson-scalable-hierarchy","title":"\ud83e\udde9 2. <code>managementgroup.json</code>: Scalable Hierarchy","text":"<p>The <code>managementgroup.json</code> file defines a single management group and its contents:</p> <ul> <li>Child Management Groups: For structure like <code>Identity</code>, <code>Connectivity</code>, <code>Platform</code>, etc.</li> <li>Policy Assignments: Compliant environments per group.</li> <li>RBAC Configuration: Access control at the group level.</li> <li>Subscriptions: Subscriptions logically grouped here.</li> <li>Optional PIM Assignments: Privileged access control.</li> </ul> <p>\ud83d\udd17 This schema maps directly to Azure Management Groups under your tenant, allowing fine-grained access, tagging, and policy enforcement per domain (e.g., business unit, environment).</p>"},{"location":"setup/overview/#3-subscriptionjson-the-deployable-unit","title":"\ud83d\udce6 3. <code>subscription.json</code>: The Deployable Unit","text":"<p>Each <code>subscription.json</code> file defines an Azure subscription in detail:</p> <ul> <li>Metadata: Subscription ID, name, tenant linkage.</li> <li>RBAC: Who gets access and what role.</li> <li>Tags: Cost center, environment labels, etc.</li> <li>Deployments: Infrastructure-as-code components (Bicep, ARM, Terraform).</li> <li>Central Config References: Shared VNet, vHub, LAW workspace.</li> <li>Marketplace Features: Enablement of CloudGrip products.</li> </ul> <p>\ud83d\udd17 This file corresponds to an actual Azure subscription, and provides everything needed to deploy infrastructure inside it.</p>"},{"location":"setup/overview/#schema-relationships","title":"\ud83d\udd04 Schema Relationships","text":""},{"location":"setup/subscription/","title":"\ud83d\udcd8 Subscription Schema Documentation","text":"<pre><code>{\n  \"$schema\": \"http://schema.ca8.io/schemas/2024-01-01/subscription.json\",\n  \"tenantId\": \"00000000-0000-0000-0000-000000000000\",\n  \"parentManagementGroupId\": \"alz-platform-management\",\n  \"subscriptionName\": \"management\",\n  \"subscriptionId\": \"00000000-0000-0000-0000-000000000000\",\n  \"location\": \"westeurope\",\n  \"centralConfig\": {},\n  \"deployments\": [],\n  \"deploymentStacks\": [],\n  \"tags\": {},\n  \"rbac\": [],\n  \"marketPlaceFeatures\": []\n}\n</code></pre> <p>Schema URL: <code>http://schema.ca8.io/schemas/2024-01-01/subscription.json</code> Version: 2024-01-01 Purpose: Defines the structure and configuration of a CloudGrip subscription object.</p>"},{"location":"setup/subscription/#top-level-structure","title":"\ud83d\udd17 Top-Level Structure","text":"Property Type Required Description <code>$schema</code> <code>string (uri)</code> \u2705 Fixed URI to schema version. <code>tenantId</code> <code>uuid</code> \u2705 Tenant ID this subscription belongs to. <code>billingAccountId</code> <code>string</code> \u274c Azure billing account ID. <code>partnerId</code> <code>string</code> \u274c Partner/Reseller ID. <code>parentManagementGroupId</code> <code>string</code> \u2705 Management group under which this subscription resides. <code>subscriptionName</code> <code>string</code> \u2705 Friendly name (e.g., \"Corp\", \"Sandbox\"). <code>subscriptionId</code> <code>uuid</code> \u2705 Azure subscription ID. <code>location</code> <code>enum</code> \u2705 Azure region or logical location. <code>centralConfig</code> <code>object</code> \u2705 Optional shared services configuration. <code>deployments</code> <code>array&lt;Deployment&gt;</code> \u2705 Bicep/ARM/Terraform deployments. <code>deploymentStacks</code> <code>array</code> \u2705 Placeholder for deployment stacks. <code>tags</code> <code>object</code> \u2705 Custom tags (e.g., env, cost center). <code>rbac</code> <code>array&lt;RBAC&gt;</code> \u2705 Role assignments for users, groups, SPNs. <code>marketPlaceFeatures</code> <code>array&lt;MarketplaceItem&gt;</code> \u2705 Marketplace integrations to enable."},{"location":"setup/subscription/#rbac","title":"\ud83d\udd10 RBAC","text":"<p>Role-Based Access Control entries.</p> Property Type Description <code>name</code> <code>string</code> Role name (e.g. Owner, Reader). <code>assignedUsers</code> <code>array&lt;email&gt;</code> Direct user access. <code>assignedGroups</code> <code>array&lt;string&gt;</code> Group names (e.g. BU-XXX). <code>assignedSpnObjectIds</code> <code>array&lt;uuid&gt;</code> SPN object IDs for automation."},{"location":"setup/subscription/#deployment","title":"\ud83d\ude80 Deployment","text":"<p>Defines infrastructure deployments per environment or service.</p> Property Type Required Description <code>name</code> <code>string</code> \u2705 Logical deployment name. <code>type</code> <code>enum</code> \u2705 <code>bicep</code>, <code>arm</code>, or <code>terraform</code>. <code>templateFilePath</code> <code>string</code> \u26a0\ufe0f Required for <code>bicep</code> or <code>arm</code>. <code>templateParameterFilePath</code> <code>string</code> \u274c Optional parameters file. <code>preScriptPath</code> <code>string</code> \u274c Optional pre-deployment script. <code>postScriptPath</code> <code>string</code> \u274c Optional post-deployment script. <code>deploymentGuid</code> <code>string</code> \u2705 Unique deployment identifier. <code>resourceGroupName</code> <code>string</code> \u274c Target resource group name."},{"location":"setup/subscription/#central-config","title":"\ud83c\udf10 Central Config","text":"<p>Optional shared services integration.</p> Property Type Description <code>vhubResourceId</code> <code>string</code> ID of connected Virtual Hub. <code>vnetResourceId</code> <code>string</code> ID of Virtual Network. <code>lawsResourceId</code> <code>string</code> ID of Log Analytics workspace. <p>All properties must match the Azure resource ID pattern.</p>"},{"location":"setup/subscription/#tags","title":"\ud83c\udff7 Tags","text":"<p>Custom metadata as key-value pairs.</p> <p>Example:</p> <pre><code>{\n  \"environment\": \"dev\",\n  \"costCenter\": \"12345\"\n}\n</code></pre>"},{"location":"setup/subscription/#marketplace-feature","title":"\ud83d\uded2 Marketplace Feature","text":"<p>Enables CA8 Marketplace integrations.</p> Property Type Required Description <code>name</code> <code>string</code> \u2705 Feature display name (e.g., CloudGrip). <code>offerId</code> <code>string</code> \u2705 Internal marketplace ID (<code>ca8-cloudgrip</code>, etc.). <code>properties</code> <code>object</code> \u2705 Custom configuration options per feature. <p>Note: <code>\u26a0\ufe0f*</code> indicates conditional requirements based on the value of other fields.</p>"},{"location":"setup/tenant/","title":"\ud83d\udcd8 Tenant Schema Documentation","text":"<p>The tenant file contains all properties and settings that are defined at tenant root level. Below is a empty base</p> <pre><code>{\n  \"$schema\": \"http://schema.ca8.io/schemas/2024-01-01/tenant.json\",\n  \"tenantName\": \"CLOUDGRIP\",\n  \"tenantId\": \"00000000-0000-0000-0000-000000000000\",\n  \"primaryDomain\": \"ca8.io\",\n  \"rootManagementGroup\": {\n    \"managementGroupId\": \"00000000-0000-0000-0000-000000000000\",\n    \"policy\": {\n      \"initiative\": [],\n      \"policy\": []\n    },\n    \"rbac\": [],\n    \"pimAssignments\": [],\n    \"subscriptions\": []\n  },\n  \"managementGroups\": [],\n  \"marketPlaceFeatures\": []\n}\n</code></pre> <p>Schema URL: <code>http://schema.ca8.io/schemas/2024-01-01/tenant.json</code> Version: 2024-01-01 Purpose: Define and manage a CloudGrip tenant and its associated Azure resources.</p>"},{"location":"setup/tenant/#top-level-structure","title":"\ud83d\udd17 Top-Level Structure","text":"Property Type Required Description <code>$schema</code> <code>string</code> (uri) \u2705 URI to the schema definition. <code>tenantName</code> <code>string</code> \u2705 Display name of the tenant. <code>tenantId</code> <code>string</code> (uuid) \u2705 Azure Active Directory (AAD) Tenant ID. <code>primaryDomain</code> <code>string</code> \u2705 Primary verified domain (e.g., <code>example.com</code>). <code>rootManagementGroup</code> <code>object</code> \u2705 Root management group definition. <code>managementGroups</code> <code>array&lt;ManagementGroup&gt;</code> \u2705 Additional management groups under the root. <code>marketPlaceFeatures</code> <code>array&lt;MarketplaceItem&gt;</code> \u2705 Marketplace features to enable."},{"location":"setup/tenant/#root-management-group","title":"\ud83d\uddc2 Root Management Group","text":"<p>Defines the foundational structure of the Azure environment.</p>"},{"location":"setup/tenant/#properties","title":"Properties","text":"Property Type Required Description <code>managementGroupId</code> <code>string</code> \u2705 ID for the root management group. <code>policy</code> <code>object</code> \u2705 Policy assignments: includes <code>initiative</code> &amp; <code>policy</code>. <code>rbac</code> <code>array&lt;RBAC&gt;</code> \u2705 Role assignments for this group. <code>pimAssignments</code> <code>array&lt;PIMAssignment&gt;</code> \u2705 Privileged Identity Management (PIM) roles. <code>subscriptions</code> <code>array&lt;Subscription&gt;</code> \u2705 Subscriptions under this group."},{"location":"setup/tenant/#rbac-definition","title":"\ud83d\udd12 RBAC Definition","text":"<p>Role-Based Access Control for users, groups, and SPNs.</p> Property Type Required Notes <code>name</code> <code>string</code> \u2705 Role name (<code>Owner</code>, <code>Reader</code>, etc.) <code>assignedUsers</code> <code>array&lt;email&gt;</code> \u2705 List of user emails. <code>assignedGroups</code> <code>array&lt;string&gt;</code> \u2705 AAD group names. <code>assignedSpnObjectIds</code> <code>array&lt;uuid&gt;</code> \u2705 List of service principal object IDs."},{"location":"setup/tenant/#management-group","title":"\ud83e\uddd1\u200d\ud83d\udcbc Management Group","text":"<p>Represents an Azure management group.</p> Property Type Required Notes <code>name</code> <code>string</code> \u2705 Friendly name of the management group. <code>id</code> <code>string</code> \u2705 Unique identifier. <code>managedBy</code> <code>enum</code> (<code>parent</code> | <code>self</code>) \u2705 Specifies if it's self-managed or inherited. <code>repoUrl</code> <code>uri</code> \u26a0\ufe0f* Required when <code>managedBy</code> = <code>self</code>. <code>ownerEmail</code> <code>email</code> \u26a0\ufe0f* Required when <code>managedBy</code> = <code>self</code>."},{"location":"setup/tenant/#subscription","title":"\ud83d\udce6 Subscription","text":"<p>An Azure subscription managed under a group.</p> Property Type Required Notes <code>name</code> <code>string</code> \u2705 Subscription name. <code>id</code> <code>uuid</code> \u2705 Subscription GUID. <code>managedBy</code> <code>enum</code> (<code>parent</code> | <code>self</code>) \u2705 Specifies management source. <code>repoUrl</code> <code>uri</code> \u26a0\ufe0f* Required when <code>managedBy</code> = <code>self</code>. <code>ownerEmail</code> <code>email</code> \u26a0\ufe0f* Required when <code>managedBy</code> = <code>self</code>."},{"location":"setup/tenant/#pim-assignment","title":"\ud83d\udd10 PIM Assignment","text":"<p>Privileged Identity Management assignment (structure is defined externally).</p>"},{"location":"setup/tenant/#required-properties","title":"Required Properties","text":"<ul> <li><code>name</code></li> <li><code>assignedUsers</code></li> <li><code>assignedGroups</code></li> <li><code>activationDurationHours</code></li> <li><code>activationRequirements</code></li> <li><code>activationAlertEmails</code></li> <li><code>activationApproverGroups</code></li> </ul>"},{"location":"setup/tenant/#marketplace-feature","title":"\ud83d\uded2 Marketplace Feature","text":"<p>Enables CA8 Marketplace integrations.</p> Property Type Required Description <code>name</code> <code>string</code> \u2705 Feature display name (e.g., CloudGrip). <code>offerId</code> <code>string</code> \u2705 Internal marketplace ID (<code>ca8-cloudgrip</code>, etc.). <code>properties</code> <code>object</code> \u2705 Custom configuration options per feature. <p>Note: <code>\u26a0\ufe0f*</code> indicates conditional requirements based on the value of other fields.</p>"}]}